<div class="p-4 md:p-8">
  <div class="max-w-full mx-auto">
    <p-card>
      <ng-template #header>
        <div class="p-4">
          <div class="flex justify-between items-start mb-4">
            <h2 class="text-2xl font-bold m-0">Analytics</h2>
            <div class="flex gap-4">
              <div>
                <label class="block text-sm font-medium mb-2">Chart Type</label>
                <p-selectbutton
                  [options]="chartTypeOptions"
                  [(ngModel)]="selectedChartType"
                  optionLabel="label"
                  optionValue="value"
                  [allowEmpty]="false"
                  (onChange)="onChartTypeChange()">
                </p-selectbutton>
              </div>
              <div>
                <label class="block text-sm font-medium mb-2">Metric</label>
                <p-selectbutton
                  [options]="metricOptions"
                  [(ngModel)]="selectedMetric"
                  optionLabel="label"
                  optionValue="value"
                  [allowEmpty]="false"
                  (onChange)="onMetricChange()">
                </p-selectbutton>
              </div>
            </div>
          </div>
          <div class="flex flex-wrap gap-4 items-center">
            <div class="flex-shrink-0">
              <label class="block text-sm font-medium mb-2">Time Range</label>
              <p-select
                [options]="timeRangeOptions"
                [(ngModel)]="selectedTimeRange"
                optionLabel="label"
                optionValue="value"
                (onChange)="onTimeRangeChange()"
                [style]="{'min-width': '200px'}">
              </p-select>
            </div>
            <div class="flex-shrink-0" *ngIf="showCustomDatePicker">
              <label class="block text-sm font-medium mb-2">Custom Date Range</label>
              <p-datepicker
                [(ngModel)]="customDateRange"
                selectionMode="range"
                [readonlyInput]="true"
                dateFormat="mm/dd/yy"
                (onSelect)="onCustomDateRangeChange()"
                [style]="{'min-width': '250px'}">
              </p-datepicker>
            </div>
            <div class="flex-shrink-0">
              <label class="block text-sm font-medium mb-2">Campaign</label>
              <p-select
                [options]="campaignFilterOptions"
                [(ngModel)]="selectedCampaignFilter"
                optionLabel="label"
                optionValue="value"
                (onChange)="onFilterChange()"
                [style]="{'min-width': '200px'}">
              </p-select>
            </div>
            <div class="flex-shrink-0">
              <label class="block text-sm font-medium mb-2">Product</label>
              <p-select
                [options]="productFilterOptions"
                [(ngModel)]="selectedProductFilter"
                optionLabel="label"
                optionValue="value"
                (onChange)="onFilterChange()"
                [style]="{'min-width': '200px'}">
              </p-select>
            </div>
          </div>
        </div>
      </ng-template>

      <p-message
        *ngIf="errorMessage"
        severity="error"
        [text]="errorMessage"
        styleClass="w-full mb-4">
      </p-message>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Total Purchases</p>
              <p class="text-2xl font-bold text-blue-600">{{ totalPurchases }}</p>
            </div>
            <i class="pi pi-shopping-cart text-3xl text-blue-400"></i>
          </div>
        </div>

        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Total Sales</p>
              <p class="text-2xl font-bold text-green-600">${{ totalSales.toFixed(2) }}</p>
            </div>
            <i class="pi pi-dollar text-3xl text-green-400"></i>
          </div>
        </div>

        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Avg Order Value</p>
              <p class="text-2xl font-bold text-purple-600">${{ averageOrderValue.toFixed(2) }}</p>
            </div>
            <i class="pi pi-chart-line text-3xl text-purple-400"></i>
          </div>
        </div>

        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Products Sold</p>
              <p class="text-2xl font-bold text-orange-600">{{ totalProductsSold }}</p>
            </div>
            <i class="pi pi-box text-3xl text-orange-400"></i>
          </div>
        </div>
      </div>

      <p-tabs [(value)]="activeTabValue" (onChange)="onTabChange($event)">
        <p-tablist>
          <p-tab value="0">All</p-tab>
          <p-tab value="1">Campaign</p-tab>
          <p-tab value="2">Product</p-tab>
        </p-tablist>

        <p-tabpanels>
          <p-tabpanel value="0">
            <div class="chart-container" style="height: 400px;">
              <p-chart
                *ngIf="!isLoading && chartData"
                [type]="selectedChartType"
                [data]="chartData"
                [options]="chartOptions"
                [style]="{'height': '100%'}">
              </p-chart>

              <div *ngIf="isLoading" class="flex justify-center items-center" style="height: 100%;">
                <i class="pi pi-spin pi-spinner text-4xl text-gray-400"></i>
              </div>

              <div *ngIf="!isLoading && !chartData" class="flex justify-center items-center" style="height: 100%;">
                <div class="text-center">
                  <i class="pi pi-chart-line text-4xl text-gray-400 mb-4"></i>
                  <p class="text-lg font-semibold mb-2">No sales data found</p>
                  <p class="text-gray-600">Sync your sales from the Sync page to see analytics.</p>
                </div>
              </div>
            </div>
          </p-tabpanel>

          <p-tabpanel value="1">
            <div class="chart-container" style="height: 400px;">
              <p-chart
                *ngIf="!isLoading && chartData"
                [type]="selectedChartType"
                [data]="chartData"
                [options]="chartOptions"
                [style]="{'height': '100%'}">
              </p-chart>

              <div *ngIf="isLoading" class="flex justify-center items-center" style="height: 100%;">
                <i class="pi pi-spin pi-spinner text-4xl text-gray-400"></i>
              </div>

              <div *ngIf="!isLoading && !chartData" class="flex justify-center items-center" style="height: 100%;">
                <div class="text-center">
                  <i class="pi pi-chart-line text-4xl text-gray-400 mb-4"></i>
                  <p class="text-lg font-semibold mb-2">No campaign data found</p>
                  <p class="text-gray-600">Sync your sales from the Sync page to see analytics.</p>
                </div>
              </div>
            </div>
          </p-tabpanel>

          <p-tabpanel value="2">
            <div class="chart-container" style="height: 400px;">
              <p-chart
                *ngIf="!isLoading && chartData"
                [type]="selectedChartType"
                [data]="chartData"
                [options]="chartOptions"
                [style]="{'height': '100%'}">
              </p-chart>

              <div *ngIf="isLoading" class="flex justify-center items-center" style="height: 100%;">
                <i class="pi pi-spin pi-spinner text-4xl text-gray-400"></i>
              </div>

              <div *ngIf="!isLoading && !chartData" class="flex justify-center items-center" style="height: 100%;">
                <div class="text-center">
                  <i class="pi pi-chart-line text-4xl text-gray-400 mb-4"></i>
                  <p class="text-lg font-semibold mb-2">No product data found</p>
                  <p class="text-gray-600">Sync your sales from the Sync page to see analytics.</p>
                </div>
              </div>
            </div>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    </p-card>
  </div>
</div>
