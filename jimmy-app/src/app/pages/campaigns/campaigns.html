<div class="p-4 md:p-8">
  <div class="max-w-full mx-auto">
    <p-card>
      <ng-template #header>
        <div class="p-4 flex justify-between items-center">
          <h2 class="text-2xl font-bold m-0">Campaigns</h2>
          <p-button
            label="Refresh"
            icon="pi pi-refresh"
            (onClick)="loadCampaigns()">
          </p-button>
        </div>
      </ng-template>

      <p-message
        *ngIf="errorMessage"
        severity="error"
        [text]="errorMessage"
        styleClass="w-full mb-4">
      </p-message>

      <p-table
        [value]="campaigns"
        [loading]="isLoading"
        [scrollable]="true"
        scrollHeight="600px"
        styleClass="p-datatable-sm">
        <ng-template #header>
          <tr>
            <th>Campaign Name</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Budget</th>
            <th>Spend</th>
            <th>Impressions</th>
            <th>Clicks</th>
            <th>Purchases</th>
            <th>Revenue</th>
            <th>CPM</th>
            <th>ROAS</th>
            <th>CTR</th>
            <th>CPC</th>
            <th>Cost/Purchase</th>
            <th>AOV</th>
            <th>Conv. Rate</th>
          </tr>
        </ng-template>
        <ng-template #body let-campaign>
          <tr>
            <td>{{ campaign.name }}</td>
            <td>{{ formatDate(campaign.start_date) }}</td>
            <td>{{ formatDate(campaign.end_date) }}</td>
            <td>{{ campaign.budget ? formatCurrency(campaign.budget) : '-' }}</td>
            <td>{{ formatCurrency(campaign.spend) }}</td>
            <td>{{ formatNumber(campaign.impressions) }}</td>
            <td>{{ formatNumber(campaign.clicks) }}</td>
            <td>{{ campaign.purchases }}</td>
            <td>{{ formatCurrency(campaign.purchase_value) }}</td>
            <td>{{ campaign.cpm > 0 ? formatCurrency(campaign.cpm) : '-' }}</td>
            <td>
              <p-tag
                *ngIf="campaign.roas > 0"
                [value]="formatDecimal(campaign.roas, 2)"
                [severity]="getROASSeverity(campaign.roas)">
              </p-tag>
              <span *ngIf="campaign.roas === 0">-</span>
            </td>
            <td>{{ campaign.ctr > 0 ? formatPercent(campaign.ctr) : '-' }}</td>
            <td>{{ campaign.cpc > 0 ? formatCurrency(campaign.cpc) : '-' }}</td>
            <td>{{ campaign.cost_per_purchase > 0 ? formatCurrency(campaign.cost_per_purchase) : '-' }}</td>
            <td>{{ campaign.avg_order_value > 0 ? formatCurrency(campaign.avg_order_value) : '-' }}</td>
            <td>{{ campaign.conversion_rate > 0 ? formatPercent(campaign.conversion_rate) : '-' }}</td>
          </tr>
        </ng-template>
        <ng-template #emptymessage>
          <tr>
            <td colspan="16" class="text-center py-8">
              <div class="flex flex-col items-center gap-4">
                <i class="pi pi-inbox text-4xl text-gray-400"></i>
                <div>
                  <p class="text-lg font-semibold mb-2">No campaigns found</p>
                  <p class="text-gray-600">Sync your campaigns from the Sync page to see them here.</p>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>
