<div class="p-4 md:p-8">
  <div class="max-w-full mx-auto">
    <p-card>
      <ng-template #header>
        <div class="p-4">
          <h2 class="text-2xl font-bold m-0">Products</h2>
        </div>
      </ng-template>

      <p-message
        *ngIf="errorMessage"
        severity="error"
        [text]="errorMessage"
        styleClass="w-full mb-4">
      </p-message>

      <p-table
        [value]="products"
        [loading]="isLoading"
        [scrollable]="true"
        scrollHeight="600px"
        styleClass="p-datatable-sm">
        <ng-template #header>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Status</th>
            <th>Price</th>
            <th>Sales</th>
            <th>Total Sales ($)</th>
            <th>Price Range</th>
          </tr>
        </ng-template>
        <ng-template #body let-product>
          <tr>
            <td>
              <img
                *ngIf="product.image_url"
                [src]="product.image_url"
                [alt]="product.name"
                class="w-12 h-12 object-cover rounded"
                [title]="product.name">
              <div
                *ngIf="!product.image_url"
                class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center">
                <i class="pi pi-image text-gray-400"></i>
              </div>
            </td>
            <td>{{ product.name }}</td>
            <td>
              <p-tag
                [value]="product.status || 'unknown'"
                [severity]="getStatusSeverity(product.status)">
              </p-tag>
            </td>
            <td>{{ formatCurrency(product.price) }}</td>
            <td>{{ product.sales_count || 0 }}</td>
            <td>{{ formatCurrency(product.total_sales_revenue || 0) }}</td>
            <td>{{ formatPriceRange(product.min_sold_price, product.max_sold_price) }}</td>
          </tr>
        </ng-template>
        <ng-template #emptymessage>
          <tr>
            <td colspan="7" class="text-center py-8">
              <div class="flex flex-col items-center gap-4">
                <i class="pi pi-inbox text-4xl text-gray-400"></i>
                <div>
                  <p class="text-lg font-semibold mb-2">No products found</p>
                  <p class="text-gray-600">Sync your products from the Sync page to see them here.</p>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>
