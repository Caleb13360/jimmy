<div class="p-4 md:p-8">
  <div class="max-w-full mx-auto">
    <p-card>
      <ng-template #header>
        <div class="p-4">
          <h2 class="text-2xl font-bold m-0">Sales</h2>
        </div>
      </ng-template>

      <p-message
        *ngIf="errorMessage"
        severity="error"
        [text]="errorMessage"
        styleClass="w-full mb-4">
      </p-message>

      <p-table
        [value]="sales"
        [loading]="isLoading"
        [scrollable]="true"
        scrollHeight="600px"
        styleClass="p-datatable-sm">
        <ng-template #header>
          <tr>
            <th>Order ID</th>
            <th>Date</th>
            <th>Campaign</th>
            <th>Status</th>
            <th>Total</th>
            <th>Items</th>
            <th>Products</th>
            <th>Source</th>
            <th>Medium</th>
            <th>Device</th>
            <th>Sessions</th>
            <th>Page Views</th>
            <th>Has Bump</th>
          </tr>
        </ng-template>
        <ng-template #body let-sale>
          <tr>
            <td>{{ sale.id }}</td>
            <td>{{ formatDate(sale.date_created) }}</td>
            <td>{{ sale.campaign_name || sale.utm_campaign || '-' }}</td>
            <td>
              <p-tag
                [value]="sale.order_status"
                [severity]="getStatusSeverity(sale.order_status)">
              </p-tag>
            </td>
            <td>{{ formatCurrency(sale.order_total) }}</td>
            <td>{{ sale.item_count || 0 }}</td>
            <td class="max-w-xs truncate" [title]="sale.product_names">{{ sale.product_names }}</td>
            <td>{{ sale.utm_source || '-' }}</td>
            <td>{{ sale.utm_medium || '-' }}</td>
            <td>
              <i [class]="'pi ' + getDeviceIcon(sale.device_type)" [title]="sale.device_type || 'Unknown'"></i>
              {{ sale.device_type || '-' }}
            </td>
            <td>{{ formatNumber(sale.session_count) }}</td>
            <td>{{ formatNumber(sale.session_page_views) }}</td>
            <td>
              <p-tag
                *ngIf="sale.has_bump"
                value="Yes"
                severity="success">
              </p-tag>
              <span *ngIf="!sale.has_bump">No</span>
            </td>
          </tr>
        </ng-template>
        <ng-template #emptymessage>
          <tr>
            <td colspan="13" class="text-center py-8">
              <div class="flex flex-col items-center gap-4">
                <i class="pi pi-inbox text-4xl text-gray-400"></i>
                <div>
                  <p class="text-lg font-semibold mb-2">No sales found</p>
                  <p class="text-gray-600">Sync your sales from the Sync page to see them here.</p>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>
